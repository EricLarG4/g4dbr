
```{r library, include=FALSE}
library(knitr)
```

# Data

```{r selected.oligos, include=FALSE}
#Extract the selected oligonucleotides names to print as a comma separated string
if (length(selected.oligos.db()) > 1) { #if more than one oligo, then use plural
  selected.oligos <- paste("oligonucleotides", paste(selected.oligos.db()[1:length(selected.oligos.db())-1], collapse=", "), "and", selected.oligos.db()[length(selected.oligos.db())])
} else { #else use singular 
  selected.oligos <- paste("oligonucleotide", paste(selected.oligos.db(), collapse=", "))
}
```

This report was generated by *g4db* for the `r selected.oligos` on `r Sys.Date()`.

```{r title, include=FALSE}
#Document title takes selected oligonucleotides values
title_var <- paste(paste(selected.oligos.db(), collapse="/"), "report")
```
---
title: `r title_var`
---

```{r oligo.table, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
#table of oligonucleotides properties (pageable)
db.info <- db.info() %>%
  filter(oligo %in% selected.oligos.db()) %>% #only display selected oligos data
  select(c('oligo', 'sequence', 'submitted_by', 'depo.date', 'DOI'))

knitr::kable(db.info,
             caption = 'General oligonucleotide information',
             escape = F) #DOI parsed in HTML reports
```

# Figures

## CD

```{r CDplot, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.cap="Circular dichroism spectra"}
p.CD.db()
```

## 1H-NMR

```{r NMRplot, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.cap="1H NMR spectra"}
p.NMR.db()
```

## UV-melting

```{r UVplot, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", fig.cap="UV-melting plot"}
p.UV.fit.db() + theme(legend.position="bottom",
                      legend.direction = 'horizontal')
p.UV.melting.db() + 
  theme(legend.position="bottom",
        legend.direction = "horizontal") +
  guides(colour=guide_legend(nrow=3*length(selected.oligos.db())))
```

```{r print.option, include=FALSE}
#controls whether MS section is knitted or not based on the use of the plotMS button
if(input$plotMS.db == 0) {
  print.option <- FALSE
} else {
  print.option <- TRUE
}
```

```{r MS.header, echo=FALSE, eval= print.option}
#conditional MS section title
asis_output("## Native ESI-MS")
```

```{r MSplot, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%", eval = print.option, fig.cap="Native ESI-MS spectra"}
  p.MS.db() + theme(legend.position="bottom",
                    legend.direction = 'horizontal')
```


